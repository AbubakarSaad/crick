machine:
  environment:
    GOPATH: "${HOME}/.go_project"
    PATH: "${PATH}:${GOPATH}/bin"

dependencies:
  override:
    - mkdir -p ~/.go_project/src/github.com/${CIRCLE_PROJECT_USERNAME}
    - ln -s ${HOME}/${CIRCLE_PROJECT_REPONAME} ${HOME}/.go_project/src/github.com/${CIRCLE_PROJECT_USERNAME}/${CIRCLE_PROJECT_REPONAME}
    - go get github.com/zenreach/go-junit-report
    - touch ${CIRCLE_TEST_REPORTS}/go-report.xml

test:
  override:
    - cd ${HOME}/.go_project/src/github.com/${CIRCLE_PROJECT_USERNAME}/${CIRCLE_PROJECT_REPONAME}/api/ \
      && make test | go-junit-report -set-exit-code=true -out=${CIRCLE_TEST_REPORTS}/go-report.xml
